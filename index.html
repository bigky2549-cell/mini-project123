<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap');
        body { font-family: 'Kanit', sans-serif; background-color: #0f172a; color: #f8fafc; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; width: 100%; max-width: 1000px; }
        .card { background: #1e293b; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid #334155; }
        .value { font-size: 3rem; font-weight: bold; color: #38bdf8; }
        .btn-group { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        button { padding: 12px 30px; border-radius: 12px; border: none; font-size: 1rem; cursor: pointer; transition: 0.3s; font-family: 'Kanit', sans-serif; }
        .btn-on { background-color: #22c55e; color: white; }
        .btn-off { background-color: #ef4444; color: white; }
        .btn-on:hover { background-color: #16a34a; }
        .btn-off:hover { background-color: #dc2626; }
        .status-box { margin-top: 10px; font-size: 0.9rem; padding: 5px 10px; border-radius: 5px; background: #334155; display: inline-block; }
        .warning { background-color: #ef4444 !important; color: white; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h1>üè† ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡πâ‡∏≤‡∏ô mini project</h1>

    <div class="dashboard">
        <div class="card">
            <div>üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</div>
            <div class="value"><span id="temp">--</span>¬∞C</div>
            <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="humi">--</span>%</div>
        </div>

        <div class="card">
            <div>‚òÄÔ∏è ‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á (LDR)</div>
            <div class="value" id="light_val">--</div>
            <div id="light_status" class="status-box">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>

        <div class="card">
            <div>üí® ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏±‡∏ô/‡πÅ‡∏Å‡πä‡∏™ (MQ)</div>
            <div class="value" id="gas_val">--</div>
            <div id="gas_status" class="status-box">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏Å‡∏ï‡∏¥</div>
        </div>

        <div class="card">
            <div>üí° ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü (Relay 1)</div>
            <div class="status-box">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="st-light">--</b></div>
            <div class="btn-group">
                <button class="btn-on" onclick="send('light', 'ON')">‡πÄ‡∏õ‡∏¥‡∏î</button>
                <button class="btn-off" onclick="send('light', 'OFF')">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>

        <div class="card">
            <div>üåÄ ‡∏û‡∏±‡∏î‡∏•‡∏° (Relay 2)</div>
            <div class="status-box">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="st-fan">--</b></div>
            <div class="btn-group">
                <button class="btn-on" onclick="send('fan', 'ON')">‡πÄ‡∏õ‡∏¥‡∏î</button>
                <button class="btn-off" onclick="send('fan', 'OFF')">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>

        <div class="card">
            <div>‚ùÑÔ∏è ‡πÅ‡∏≠‡∏£‡πå‡∏à‡∏≥‡∏•‡∏≠‡∏á (Relay 3)</div>
            <div class="status-box">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="st-ac">--</b></div>
            <div class="btn-group">
                <button class="btn-on" onclick="send('ac', 'ON')">‡πÄ‡∏õ‡∏¥‡∏î</button>
                <button class="btn-off" onclick="send('ac', 'OFF')">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script>
        // *** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Config ‡∏ô‡∏µ‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô‡∏ö‡∏≠‡∏£‡πå‡∏î NodeMCU ***
        const firebaseConfig = {
            apiKey: "AIzaSyDVK0e02FBue3EW0e7JqbCKPe6YE7zREqE",
            authDomain: "mini-project-2fa5e.firebaseapp.com",
            databaseURL: "https://mini-project-2fa5e-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "mini-project-2fa5e",
            storageBucket: "mini-project-2fa5e.appspot.com",
            messagingSenderId: "336990756770",
            appId: "1:336990756770:web:73753e5604463516879cfb"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Path "room"
        db.ref("room").on("value", (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                document.getElementById("temp").innerText = data.temp !== undefined ? data.temp : "--";
                document.getElementById("humi").innerText = data.humi !== undefined ? data.humi : "--";
                document.getElementById("light_val").innerText = data.light !== undefined ? data.light : "--";
                document.getElementById("gas_val").innerText = data.gas !== undefined ? data.gas : "--";

                // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏™‡∏á (LDR)
                const lStatus = document.getElementById("light_status");
                if (data.light < 500) {
                    lStatus.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏°‡∏∑‡∏î (‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ)";
                } else {
                    lStatus.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏ß‡πà‡∏≤‡∏á";
                }

                // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏Å‡πä‡∏™
                const gStatus = document.getElementById("gas_status");
                // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 400 ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Digital Sensor ‡∏Ñ‡πà‡∏≤ 1 ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏à‡∏≠
                if (data.gas > 400 || data.gas == 1) { 
                    gStatus.innerText = "‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏±‡∏ô/‡πÅ‡∏Å‡πä‡∏™!";
                    gStatus.className = "status-box warning";
                } else {
                    gStatus.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏Å‡∏ï‡∏¥";
                    gStatus.className = "status-box";
                }
            }
        }, (error) => {
            console.error("Firebase Error: ", error);
        });

        // 2. ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å Path "control"
        db.ref("control").on("value", (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById("st-light").innerText = data.light || "OFF";
                document.getElementById("st-fan").innerText = data.fan || "OFF";
                document.getElementById("st-ac").innerText = data.ac || "OFF";
            }
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase
        function send(path, cmd) {
            db.ref("control/" + path).set(cmd)
                .then(() => console.log("Sent " + cmd + " to " + path))
                .catch((err) => alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message));
        }
    </script>
</body>
</html>